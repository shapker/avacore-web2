<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avacore - –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</title>
    <meta name="description" content="Avacore - –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —É–¥–∞–ª–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π Telegram">
    <meta name="keywords" content="telegram, –±–æ—Ç, —Å–æ–æ–±—â–µ–Ω–∏—è, –º–µ–¥–∏–∞, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, —É–¥–∞–ª–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è">
    <meta name="author" content="Avacore Team">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üõ°Ô∏è</text></svg>">
    
    <!-- CSS –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Å—Ç–∏–ª–∏ -->
    <style>
        /* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ Avacore */
        :root {
            --primary-color: #007bff;
            --success-color: #28a745;
            --info-color: #17a2b8;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
        }

        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .navbar-brand {
            font-weight: 700;
            font-size: 1.5rem;
        }

        .content-section {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        #statsSection {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .stats-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: none;
            border-radius: 10px;
            overflow: hidden;
        }

        .stats-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .card-header {
            background: linear-gradient(135deg, var(--primary-color), #0056b3);
            color: white;
            border: none;
            font-weight: 600;
        }

        .bg-primary { background: linear-gradient(135deg, var(--primary-color), #0056b3) !important; }
        .bg-success { background: linear-gradient(135deg, var(--success-color), #1e7e34) !important; }
        .bg-info { background: linear-gradient(135deg, var(--info-color), #138496) !important; }
        .bg-warning { background: linear-gradient(135deg, var(--warning-color), #e0a800) !important; }

        .table th {
            border-top: none;
            background-color: #f8f9fa;
            font-weight: 600;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .container {
                padding: 0 10px;
            }
            
            .stats-card .card-body {
                padding: 1rem;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            .navbar-brand {
                font-size: 1.2rem;
            }
            
            .navbar-nav {
                text-align: center;
            }
        }

        /* –ó–∞–≥—Ä—É–∑–∫–∞ */
        .spinner-border {
            width: 3rem;
            height: 3rem;
        }

        .loading-text {
            color: #6c757d;
            font-size: 1.1rem;
        }

        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .alert {
            border: none;
            border-radius: 10px;
            border-left: 4px solid;
        }

        /* –§—É—Ç–µ—Ä */
        footer {
            margin-top: auto;
            background: white !important;
            border-top: 1px solid #dee2e6;
        }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .nav-link {
            border-radius: 5px;
            margin: 0 2px;
            transition: all 0.3s ease;
        }

        .nav-link:hover {
            background-color: rgba(255,255,255,0.1);
        }

        .nav-link.active {
            background-color: rgba(255,255,255,0.2);
            font-weight: 600;
        }

        /* –ì—Ä–∞—Ñ–∏–∫–∏ */
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }

        /* –£–ª—É—á—à–µ–Ω–∏—è –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã */
        .table-responsive {
            border-radius: 10px;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        }

        .table td {
            vertical-align: middle;
        }

        /* –ë–µ–π–¥–∂–∏ */
        .badge {
            font-size: 0.75em;
            padding: 0.4em 0.6em;
        }
    </style>
</head>
<body>
    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-shield-alt"></i> Avacore
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <div class="navbar-nav ms-auto">
                    <a class="nav-link active" href="#" onclick="showSection('stats')">
                        <i class="fas fa-chart-bar"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                    </a>
                    <a class="nav-link" href="#" onclick="showSection('messages')">
                        <i class="fas fa-comments"></i> –°–æ–æ–±—â–µ–Ω–∏—è
                    </a>
                    <a class="nav-link" href="#" onclick="showSection('media')">
                        <i class="fas fa-photo-video"></i> –ú–µ–¥–∏–∞
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="container mt-4 flex-grow-1">
        <!-- –ó–∞–≥—Ä—É–∑–∫–∞ -->
        <div id="loadingSection" class="text-center py-5">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
            </div>
            <p class="mt-3 loading-text">–ó–∞–≥—Ä—É–∑–∫–∞ –≤–∞—à–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...</p>
        </div>

        <!-- –û—à–∏–±–∫–∞ -->
        <div id="errorSection" class="alert alert-danger" style="display: none;">
            <h4><i class="fas fa-exclamation-triangle"></i> –û—à–∏–±–∫–∞</h4>
            <p id="errorMessage">–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö</p>
            <div class="mt-3">
                <button class="btn btn-outline-danger" onclick="location.reload()">
                    <i class="fas fa-redo"></i> –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
                </button>
                <button class="btn btn-outline-primary ms-2" onclick="window.close()">
                    <i class="fas fa-times"></i> –ó–∞–∫—Ä—ã—Ç—å
                </button>
            </div>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <div id="mainContent" style="display: none;">
            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div id="statsSection" class="content-section">
                <div class="row">
                    <div class="col-12">
                        <h1><i class="fas fa-chart-bar"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h1>
                        <p class="text-muted" id="lastUpdate"></p>
                    </div>
                </div>

                <div class="row mt-4" id="statsCards">
                    <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                </div>

                <div class="row mt-4">
                    <div class="col-lg-8 mb-4">
                        <div class="card h-100">
                            <div class="card-header">
                                <h5><i class="fas fa-chart-line"></i> –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∑–∞ 7 –¥–Ω–µ–π</h5>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="activityChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4 mb-4">
                        <div class="card h-100">
                            <div class="card-header">
                                <h5><i class="fas fa-chart-pie"></i> –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–µ–¥–∏–∞</h5>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="mediaChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
            <div id="messagesSection" class="content-section" style="display: none;">
                <div class="row">
                    <div class="col-12">
                        <h1><i class="fas fa-comments"></i> –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è</h1>
                        <p class="text-muted">–ò—Å—Ç–æ—Ä–∏—è –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π</p>
                    </div>
                </div>
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-striped table-hover">
                                        <thead>
                                            <tr>
                                                <th>–¢–∏–ø</th>
                                                <th>–û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å</th>
                                                <th>–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ</th>
                                                <th>–î–∞—Ç–∞</th>
                                            </tr>
                                        </thead>
                                        <tbody id="messagesTable">
                                            <!-- –°–æ–æ–±—â–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ú–µ–¥–∏–∞ -->
            <div id="mediaSection" class="content-section" style="display: none;">
                <div class="row">
                    <div class="col-12">
                        <h1><i class="fas fa-photo-video"></i> –ú–µ–¥–∏–∞—Ñ–∞–π–ª—ã</h1>
                        <p class="text-muted">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º –º–µ–¥–∏–∞</p>
                    </div>
                </div>
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                <div class="row" id="mediaStatsCards">
                                    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–µ–¥–∏–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –§—É—Ç–µ—Ä -->
    <footer class="mt-5 py-4 bg-light">
        <div class="container text-center">
            <p class="text-muted mb-0">
                Avacore &copy; 2024 ‚Ä¢ 
                <a href="#" onclick="location.reload()" class="text-decoration-none">
                    <i class="fas fa-redo"></i> –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
                </a>
            </p>
        </div>
    </footer>

    <!-- JavaScript –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π JavaScript –∫–æ–¥ -->
    <script>
        // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentData = null;
        let activityChart = null;
        let mediaChart = null;

        // –§—É–Ω–∫—Ü–∏–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        function showSection(sectionName) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Ä–∞–∑–¥–µ–ª—ã
            document.querySelectorAll('.content-section').forEach(section => {
                section.style.display = 'none';
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ä–∞–∑–¥–µ–ª
            document.getElementById(sectionName + 'Section').style.display = 'block';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // –ï—Å–ª–∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É, –æ–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–∞—Ñ–∏–∫–∏
            if (sectionName === 'stats' && currentData) {
                setTimeout(() => {
                    updateCharts();
                }, 100);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ URL
        function decompressData() {
            try {
                const urlParams = new URLSearchParams(window.location.search);
                let compressedData = urlParams.get('data');
                
                if (!compressedData) {
                    throw new Error('–î–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ URL. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /web –≤ –±–æ—Ç–µ.');
                }
                
                console.log('üîó –ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –∏–∑ URL:', compressedData.length, '—Å–∏–º–≤–æ–ª–æ–≤');
                
                // –î–æ–±–∞–≤–ª—è–µ–º padding –µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ
                while (compressedData.length % 4 !== 0) {
                    compressedData += '=';
                }
                
                // –î–µ–∫–æ–¥–∏—Ä—É–µ–º base64
                const decodedStr = atob(compressedData);
                const data = JSON.parse(decodedStr);
                
                console.log('üìä –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω—ã:', data);
                return data;
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è:', error);
                
                // –°–æ–∑–¥–∞–µ–º –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
                const demoData = {
                    user_id: 12345,
                    total_messages: 15,
                    text_messages: 10,
                    media_messages: 5,
                    unique_senders: 3,
                    daily_stats: [
                        {date: new Date(Date.now() - 6 * 24 * 60 * 60 * 1000).toISOString().split('T')[0], count: 5},
                        {date: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString().split('T')[0], count: 3},
                        {date: new Date(Date.now() - 4 * 24 * 60 * 60 * 1000).toISOString().split('T')[0], count: 7},
                        {date: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString().split('T')[0], count: 2},
                        {date: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString().split('T')[0], count: 8},
                        {date: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000).toISOString().split('T')[0], count: 6},
                        {date: new Date().toISOString().split('T')[0], count: 4}
                    ],
                    recent_messages: [
                        {text: '–ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ', user_login: 'test_user', is_media: false, date: new Date().toISOString()},
                        {text: '–ü–æ—Å–º–æ—Ç—Ä–∏ —ç—Ç–æ —Ñ–æ—Ç–æ', user_login: 'test_user2', is_media: true, path: 'media/photo_123.jpg', date: new Date(Date.now() - 300000).toISOString()},
                        {text: '–ï—â–µ –æ–¥–Ω–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞', user_login: 'test_user', is_media: false, date: new Date(Date.now() - 600000).toISOString()}
                    ],
                    media_stats: {photo: 3, video: 1, audio: 1, sticker: 0, document: 0},
                    timestamp: new Date().toISOString()
                };
                
                console.log('üîÑ –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞');
                return demoData;
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function displayStats(data) {
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
            document.getElementById('lastUpdate').textContent = 
                `–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: ${new Date().toLocaleString('ru-RU')}`;
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            const statsCards = document.getElementById('statsCards');
            statsCards.innerHTML = `
                <div class="col-md-3 mb-4">
                    <div class="card stats-card bg-primary text-white">
                        <div class="card-body text-center">
                            <i class="fas fa-comments fa-2x mb-3"></i>
                            <h3 class="card-title">${data.total_messages}</h3>
                            <p class="card-text">–í—Å–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-4">
                    <div class="card stats-card bg-success text-white">
                        <div class="card-body text-center">
                            <i class="fas fa-font fa-2x mb-3"></i>
                            <h3 class="card-title">${data.text_messages}</h3>
                            <p class="card-text">–¢–µ–∫—Å—Ç–æ–≤—ã—Ö</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-4">
                    <div class="card stats-card bg-info text-white">
                        <div class="card-body text-center">
                            <i class="fas fa-photo-video fa-2x mb-3"></i>
                            <h3 class="card-title">${data.media_messages}</h3>
                            <p class="card-text">–ú–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-4">
                    <div class="card stats-card bg-warning text-white">
                        <div class="card-body text-center">
                            <i class="fas fa-users fa-2x mb-3"></i>
                            <h3 class="card-title">${data.unique_senders}</h3>
                            <p class="card-text">–û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª–µ–π</p>
                        </div>
                    </div>
                </div>
            `;
        }

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
        function displayMessages(messages) {
            const messagesTable = document.getElementById('messagesTable');
            
            if (!messages || messages.length === 0) {
                messagesTable.innerHTML = `
                    <tr>
                        <td colspan="4" class="text-center py-4">
                            <i class="fas fa-inbox fa-2x text-muted mb-2"></i>
                            <p class="text-muted">–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            let html = '';
            messages.forEach((msg, index) => {
                const typeBadge = msg.is_media ? 
                    '<span class="badge bg-info"><i class="fas fa-file"></i> –ú–µ–¥–∏–∞</span>' : 
                    '<span class="badge bg-primary"><i class="fas fa-text"></i> –¢–µ–∫—Å—Ç</span>';
                
                const content = msg.is_media ? 
                    `<i class="fas fa-file"></i> ${msg.path ? msg.path.split('/').pop() : '–§–∞–π–ª'}` : 
                    (msg.text ? msg.text.substring(0, 100) + (msg.text.length > 100 ? '...' : '') : '–ü—É—Å—Ç–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ');
                
                const date = msg.date ? new Date(msg.date).toLocaleString('ru-RU') : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                
                html += `
                    <tr>
                        <td>${typeBadge}</td>
                        <td><strong>${msg.user_login || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</strong></td>
                        <td class="text-break">${content}</td>
                        <td><small class="text-muted">${date}</small></td>
                    </tr>
                `;
            });
            
            messagesTable.innerHTML = html;
        }

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –º–µ–¥–∏–∞
        function displayMediaStats(mediaStats) {
            const mediaStatsCards = document.getElementById('mediaStatsCards');
            
            const mediaTypes = [
                { type: 'photo', name: '–§–æ—Ç–æ', icon: 'fa-camera', color: 'primary' },
                { type: 'video', name: '–í–∏–¥–µ–æ', icon: 'fa-video', color: 'success' },
                { type: 'audio', name: '–ê—É–¥–∏–æ', icon: 'fa-microphone', color: 'info' },
                { type: 'sticker', name: '–°—Ç–∏–∫–µ—Ä—ã', icon: 'fa-smile', color: 'warning' },
                { type: 'document', name: '–î–æ–∫—É–º–µ–Ω—Ç—ã', icon: 'fa-file', color: 'secondary' }
            ];
            
            let html = '';
            mediaTypes.forEach(mediaType => {
                const count = mediaStats[mediaType.type] || 0;
                html += `
                    <div class="col-md-4 mb-4">
                        <div class="card stats-card bg-${mediaType.color} text-white">
                            <div class="card-body text-center">
                                <i class="fas ${mediaType.icon} fa-2x mb-3"></i>
                                <h3 class="card-title">${count}</h3>
                                <p class="card-text">${mediaType.name}</p>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –º–µ–¥–∏–∞
            const totalMedia = Object.values(mediaStats).reduce((a, b) => a + b, 0);
            html += `
                <div class="col-12 mt-3">
                    <div class="card bg-light">
                        <div class="card-body text-center">
                            <h5 class="card-title">–í—Å–µ–≥–æ –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤</h5>
                            <h2 class="text-primary">${totalMedia}</h2>
                        </div>
                    </div>
                </div>
            `;
            
            mediaStatsCards.innerHTML = html;
        }

        // –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤
        function createCharts(data) {
            createActivityChart(data.daily_stats || []);
            createMediaDistributionChart(data.media_stats || {});
        }

        function createActivityChart(dailyStats) {
            const ctx = document.getElementById('activityChart').getContext('2d');
            
            // –£–Ω–∏—á—Ç–æ–∂–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –≥—Ä–∞—Ñ–∏–∫ –µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
            if (activityChart) {
                activityChart.destroy();
            }
            
            // –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥–ª—É—à–∫—É
            if (!dailyStats || dailyStats.length === 0) {
                ctx.font = '16px Arial';
                ctx.fillStyle = '#6c757d';
                ctx.textAlign = 'center';
                ctx.fillText('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è', ctx.canvas.width / 2, ctx.canvas.height / 2);
                return;
            }
            
            const labels = dailyStats.map(day => {
                const date = new Date(day.date);
                return date.toLocaleDateString('ru-RU', { weekday: 'short', month: 'short', day: 'numeric' });
            });
            
            const counts = dailyStats.map(day => day.count);
            
            activityChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '–°–æ–æ–±—â–µ–Ω–∏–π –≤ –¥–µ–Ω—å',
                        data: counts,
                        backgroundColor: 'rgba(54, 162, 235, 0.1)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        }
                    }
                }
            });
        }

        function createMediaDistributionChart(mediaStats) {
            const ctx = document.getElementById('mediaChart').getContext('2d');
            
            // –£–Ω–∏—á—Ç–æ–∂–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –≥—Ä–∞—Ñ–∏–∫ –µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
            if (mediaChart) {
                mediaChart.destroy();
            }
            
            const mediaTypes = ['photo', 'video', 'audio', 'sticker', 'document'];
            const labels = ['–§–æ—Ç–æ', '–í–∏–¥–µ–æ', '–ê—É–¥–∏–æ', '–°—Ç–∏–∫–µ—Ä—ã', '–î–æ–∫—É–º–µ–Ω—Ç—ã'];
            const data = mediaTypes.map(type => mediaStats[type] || 0);
            const backgroundColors = [
                'rgba(54, 162, 235, 0.8)',
                'rgba(75, 192, 192, 0.8)',
                'rgba(153, 102, 255, 0.8)',
                'rgba(255, 205, 86, 0.8)',
                'rgba(201, 203, 207, 0.8)'
            ];
            
            // –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –º–µ–¥–∏–∞
            if (data.every(val => val === 0)) {
                ctx.font = '16px Arial';
                ctx.fillStyle = '#6c757d';
                ctx.textAlign = 'center';
                ctx.fillText('–ù–µ—Ç –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤', ctx.canvas.width / 2, ctx.canvas.height / 2);
                return;
            }
            
            mediaChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: backgroundColors,
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        }
                    },
                    cutout: '60%'
                }
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤
        function updateCharts() {
            if (currentData) {
                createCharts(currentData);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –æ—à–∏–±–∫–∏
        function showError(message) {
            document.getElementById('loadingSection').style.display = 'none';
            document.getElementById('errorSection').style.display = 'block';
            document.getElementById('errorMessage').textContent = message;
            console.error('‚ùå –û—à–∏–±–∫–∞:', message);
        }

        // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
        function initApp() {
            console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Avacore Web...');
            
            try {
                // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ URL
                const data = decompressData();
                currentData = data;
                
                // –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç
                document.getElementById('loadingSection').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
                
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                displayStats(data);
                displayMessages(data.recent_messages);
                displayMediaStats(data.media_stats);
                createCharts(data);
                
                console.log('‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ');
                
            } catch (error) {
                showError(error.message);
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏
            setTimeout(initApp, 1000);
        });
    </script>
</body>
</html>
